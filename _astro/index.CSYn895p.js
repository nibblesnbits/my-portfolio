import{M as S,j as R,u as $,P as T,k as W,e as A,L as D}from"./proxy.B9rkw6k1.js";import{r as t}from"./index.BVOCwoKb.js";class H extends t.Component{getSnapshotBeforeUpdate(c){const e=this.props.childRef.current;if(e&&c.isPresent&&!this.props.isPresent){const s=e.offsetParent,d=s instanceof HTMLElement&&s.offsetWidth||0,n=this.props.sizeRef.current;n.height=e.offsetHeight||0,n.width=e.offsetWidth||0,n.top=e.offsetTop,n.left=e.offsetLeft,n.right=d-n.width-n.left}return null}componentDidUpdate(){}render(){return this.props.children}}function K({children:f,isPresent:c,anchorX:e}){const s=t.useId(),d=t.useRef(null),n=t.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:p}=t.useContext(S);return t.useInsertionEffect(()=>{const{width:C,height:r,top:y,left:o,right:u}=n.current;if(c||!d.current||!C||!r)return;const a=e==="left"?`left: ${o}`:`right: ${u}`;d.current.dataset.motionPopId=s;const l=document.createElement("style");return p&&(l.nonce=p),document.head.appendChild(l),l.sheet&&l.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${C}px !important;
            height: ${r}px !important;
            ${a}px !important;
            top: ${y}px !important;
          }
        `),()=>{document.head.removeChild(l)}},[c]),R.jsx(H,{isPresent:c,childRef:d,sizeRef:n,children:t.cloneElement(f,{ref:d})})}const U=({children:f,initial:c,isPresent:e,onExitComplete:s,custom:d,presenceAffectsLayout:n,mode:p,anchorX:C})=>{const r=$(b),y=t.useId();let o=!0,u=t.useMemo(()=>(o=!1,{id:y,initial:c,isPresent:e,custom:d,onExitComplete:a=>{r.set(a,!0);for(const l of r.values())if(!l)return;s&&s()},register:a=>(r.set(a,!1),()=>r.delete(a))}),[e,r,s]);return n&&o&&(u={...u}),t.useMemo(()=>{r.forEach((a,l)=>r.set(l,!1))},[e]),t.useEffect(()=>{!e&&!r.size&&s&&s()},[e]),p==="popLayout"&&(f=R.jsx(K,{isPresent:e,anchorX:C,children:f})),R.jsx(T.Provider,{value:u,children:f})};function b(){return new Map}const E=f=>f.key||"";function v(f){const c=[];return t.Children.forEach(f,e=>{t.isValidElement(e)&&c.push(e)}),c}const G=({children:f,custom:c,initial:e=!0,onExitComplete:s,presenceAffectsLayout:d=!0,mode:n="sync",propagate:p=!1,anchorX:C="left"})=>{const[r,y]=W(p),o=t.useMemo(()=>v(f),[f]),u=p&&!r?[]:o.map(E),a=t.useRef(!0),l=t.useRef(o),x=$(()=>new Map),[L,k]=t.useState(o),[m,w]=t.useState(o);A(()=>{a.current=!1,l.current=o;for(let h=0;h<m.length;h++){const i=E(m[h]);u.includes(i)?x.delete(i):x.get(i)!==!0&&x.set(i,!1)}},[m,u.length,u.join("-")]);const P=[];if(o!==L){let h=[...o];for(let i=0;i<m.length;i++){const g=m[i],M=E(g);u.includes(M)||(h.splice(i,0,g),P.push(g))}return n==="wait"&&P.length&&(h=P),w(v(h)),k(o),null}const{forceRender:z}=t.useContext(D);return R.jsx(R.Fragment,{children:m.map(h=>{const i=E(h),g=p&&!r?!1:o===m||u.includes(i),M=()=>{if(x.has(i))x.set(i,!0);else return;let j=!0;x.forEach(I=>{I||(j=!1)}),j&&(z?.(),w(l.current),p&&y?.(),s&&s())};return R.jsx(U,{isPresent:g,initial:!a.current||e?void 0:!1,custom:c,presenceAffectsLayout:d,mode:n,onExitComplete:g?void 0:M,anchorX:C,children:h},i)})})};export{G as A};
